name: otel-capture
description: OpenTelemetry span capture
type: fastify-plugin
hooks:
  onRequest:
    - action: startSpan
      name: llm-call
      attributes:
        gen_ai.system: $detected.provider
        gen_ai.request.model: $request.body.model
  onResponse:
    - action: endSpan
      attributes:
        gen_ai.usage.input_tokens: $response.usage.prompt_tokens
        gen_ai.usage.output_tokens: $response.usage.completion_tokens
        flusk.cost: $middleware.costUsd
decorators:
  - name: fluskCapture
    type: function
options:
  prefix: /v1
