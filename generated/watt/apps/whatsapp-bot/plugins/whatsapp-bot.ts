// @generated by flusk-lang â€” DO NOT EDIT

import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

import { webhookIncoming } from '../functions/webhookIncoming.js';
import { webhookVerify } from '../functions/webhookVerify.js';
import { createBot } from '../functions/createBot.js';
import { updateBot } from '../functions/updateBot.js';
import { listBots } from '../functions/listBots.js';
import { getBotStats } from '../functions/getBotStats.js';
import { listConversations } from '../functions/listConversations.js';
import { getConversationMessages } from '../functions/getConversationMessages.js';
import { generateAiReply } from '../functions/generateAiReply.js';
import { sendWhatsappMessage } from '../functions/sendWhatsappMessage.js';

export default fp(async (app: FastifyInstance) => {

  app.post('/webhooks/whatsapp/:botId', {
    schema: {
      body: {
        type: 'object',
        properties: {
          message: { type: 'string' },
        },
        required: ['message'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await webhookIncoming(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/webhooks/whatsapp/:botId', {
    schema: {
      body: {
        type: 'object',
        properties: {
          hub.verify_token: { type: 'string' },
          hub.challenge: { type: 'string' },
        },
      },
    },
  }, async (request, reply) => {
    const result = await webhookVerify(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/bots', {
    schema: {
      body: {
        type: 'object',
        properties: {
          name: { type: 'string' },
          phone_number: { type: 'string' },
          system_prompt: { type: 'string' },
          model: { type: 'string' },
        },
        required: ['name', 'phone_number', 'system_prompt'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await createBot(app.platformatic, request);
    return reply.send(result);
  });

  app.put('/api/bots/:id', {
    schema: {
      body: {
        type: 'object',
        properties: {
          name: { type: 'string' },
          system_prompt: { type: 'string' },
          model: { type: 'string' },
          active: { type: 'boolean' },
        },
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await updateBot(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/bots', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await listBots(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/bots/:id/stats', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getBotStats(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/bots/:id/conversations', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await listConversations(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/bots/:id/conversations/:conversationId/messages', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getConversationMessages(app.platformatic, request);
    return reply.send(result);
  });
});
