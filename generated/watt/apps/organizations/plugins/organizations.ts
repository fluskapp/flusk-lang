// @generated by flusk-lang â€” DO NOT EDIT

import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

import { registerOrg } from '../functions/registerOrg.js';
import { login } from '../functions/login.js';
import { inviteMember } from '../functions/inviteMember.js';
import { acceptInvite } from '../functions/acceptInvite.js';
import { getOrg } from '../functions/getOrg.js';
import { listMembers } from '../functions/listMembers.js';
import { updateMemberRole } from '../functions/updateMemberRole.js';
import { rotateApiKey } from '../functions/rotateApiKey.js';
import { verifyCredentials } from '../functions/verifyCredentials.js';
import { processInvite } from '../functions/processInvite.js';
import { generateApiKey } from '../functions/generateApiKey.js';

export default fp(async (app: FastifyInstance) => {

  app.post('/api/auth/register', {
    schema: {
      body: {
        type: 'object',
        properties: {
          org_name: { type: 'string' },
          email: { type: 'string' },
          password: { type: 'string' },
          name: { type: 'string' },
        },
        required: ['org_name', 'email', 'password', 'name'],
      },
    },
  }, async (request, reply) => {
    const result = await registerOrg(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/auth/login', {
    schema: {
      body: {
        type: 'object',
        properties: {
          email: { type: 'string' },
          password: { type: 'string' },
        },
        required: ['email', 'password'],
      },
    },
  }, async (request, reply) => {
    const result = await login(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/org/invite', {
    schema: {
      body: {
        type: 'object',
        properties: {
          email: { type: 'string' },
          role: { type: 'string' },
        },
        required: ['email'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await inviteMember(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/auth/accept-invite', {
    schema: {
      body: {
        type: 'object',
        properties: {
          token: { type: 'string' },
          name: { type: 'string' },
          password: { type: 'string' },
        },
        required: ['token', 'name', 'password'],
      },
    },
  }, async (request, reply) => {
    const result = await acceptInvite(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/org', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getOrg(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/org/members', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await listMembers(app.platformatic, request);
    return reply.send(result);
  });

  app.patch('/api/org/members/:memberId', {
    schema: {
      body: {
        type: 'object',
        properties: {
          role: { type: 'string' },
        },
        required: ['role'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await updateMemberRole(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/org/rotate-key', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await rotateApiKey(app.platformatic, request);
    return reply.send(result);
  });
});
