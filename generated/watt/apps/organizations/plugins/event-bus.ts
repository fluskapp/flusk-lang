// @generated by flusk-lang â€” DO NOT EDIT

import { EventEmitter } from 'node:events';
import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

export const ORG_CREATED = 'org-created';
export const MEMBER_INVITED = 'member-invited';

export interface OrgCreatedPayload {
  org_id: string;
  name: string;
}

export interface MemberInvitedPayload {
  invite_id: string;
  email: string;
  org_name: string;
}

export interface FluskEvents {
  'org-created': OrgCreatedPayload;
  'member-invited': MemberInvitedPayload;
}

export class FluskEventBus {
  private emitter = new EventEmitter();

  emit<K extends keyof FluskEvents>(event: K, payload: FluskEvents[K]): void {
    this.emitter.emit(event, payload);
  }

  on<K extends keyof FluskEvents>(event: K, handler: (payload: FluskEvents[K]) => void | Promise<void>): void {
    this.emitter.on(event, handler);
  }

  off<K extends keyof FluskEvents>(event: K, handler: (payload: FluskEvents[K]) => void | Promise<void>): void {
    this.emitter.off(event, handler);
  }
}

declare module 'fastify' {
  interface FastifyInstance {
    events: FluskEventBus;
  }
}

export default fp(async (app: FastifyInstance) => {
  const bus = new FluskEventBus();
  app.decorate('events', bus);
  app.log.info('Event bus registered');
});
