// @generated by flusk-lang logic compiler
import type { FastifyInstance, FastifyRequest, FastifyReply } from 'fastify';

interface SendSlackMessageInput {
  channel: string;
  text: string;
}

export default async function sendSlackMessage(
  app: FastifyInstance,
  request: FastifyRequest,
  reply: FastifyReply,
  input: SendSlackMessageInput,
) {
  const config = await app.platformatic.entities.botConfig.find({ where: { active: true }, limit: 1 }).then(r => r[0] ?? null);
  if (!(config)) {
    return reply.code(500).send({ error: 'No active Slack bot configured' });
  }
  const result = http.post('https://slack.com/api/chat.postMessage', { channel: input.channel, text: input.text });
  return reply.send({ ok: result.ok, ts: result.ts });
}
