// @generated by flusk-lang â€” DO NOT EDIT

import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

import { agentRegister } from '../functions/agentRegister.js';
import { agentGetConfig } from '../functions/agentGetConfig.js';
import { agentReportError } from '../functions/agentReportError.js';
import { updateAgentConfig } from '../functions/updateAgentConfig.js';
import { getAgentLogs } from '../functions/getAgentLogs.js';
import { getAgentConfig } from '../functions/getAgentConfig.js';
import { bumpAgentConfig } from '../functions/bumpAgentConfig.js';
import { pushToAgents } from '../functions/pushToAgents.js';

export default fp(async (app: FastifyInstance) => {

  app.post('/api/v1/agent/register', {
    schema: {
      body: {
        type: 'object',
        properties: {
          device_id: { type: 'string' },
          hostname: { type: 'string' },
          os: { type: 'string' },
          arch: { type: 'string' },
          agent_version: { type: 'string' },
        },
        required: ['device_id', 'hostname', 'os', 'arch', 'agent_version'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await agentRegister(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/v1/agent/config', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await agentGetConfig(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/v1/agent/error', {
    schema: {
      body: {
        type: 'object',
        properties: {
          device_id: { type: 'string' },
          error_type: { type: 'string' },
          message: { type: 'string' },
          stack: { type: 'string' },
        },
        required: ['device_id', 'error_type', 'message'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await agentReportError(app.platformatic, request);
    return reply.send(result);
  });

  app.put('/api/org/agent-config', {
    schema: {
      body: {
        type: 'object',
        properties: {
          heartbeat_interval_ms: { type: 'string' },
          intercept_patterns: { type: 'string' },
        },
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await updateAgentConfig(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/org/agent-logs', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getAgentLogs(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/org/agent-config', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getAgentConfig(app.platformatic, request);
    return reply.send(result);
  });
});
