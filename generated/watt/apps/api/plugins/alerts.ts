// @generated by flusk-lang â€” DO NOT EDIT

import type { FastifyInstance, FastifyRequest, FastifyReply } from 'fastify';
import fp from 'fastify-plugin';

import createAlert from '../functions/createAlert.js';
import checkUsageSpike from '../functions/checkUsageSpike.js';
import sendAlertNotification from '../functions/sendAlertNotification.js';
import listAlerts from '../functions/listAlerts.js';
import getAlert from '../functions/getAlert.js';
import acknowledgeAlert from '../functions/acknowledgeAlert.js';
import resolveAlert from '../functions/resolveAlert.js';
import dismissAlert from '../functions/dismissAlert.js';
import listAlertRules from '../functions/listAlertRules.js';
import createAlertRule from '../functions/createAlertRule.js';
import updateAlertRule from '../functions/updateAlertRule.js';
import deleteAlertRule from '../functions/deleteAlertRule.js';

export default fp(async (app: FastifyInstance) => {

  // GET /api/alerts
  app.get('/api/alerts', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return listAlerts(app, request, reply, input);
  });

  // GET /api/alerts/:alertId
  app.get('/api/alerts/:alertId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return getAlert(app, request, reply, input);
  });

  // PATCH /api/alerts/:alertId/ack
  app.patch('/api/alerts/:alertId/ack', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return acknowledgeAlert(app, request, reply, input);
  });

  // PATCH /api/alerts/:alertId/resolve
  app.patch('/api/alerts/:alertId/resolve', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return resolveAlert(app, request, reply, input);
  });

  // PATCH /api/alerts/:alertId/dismiss
  app.patch('/api/alerts/:alertId/dismiss', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return dismissAlert(app, request, reply, input);
  });

  // GET /api/alert-rules
  app.get('/api/alert-rules', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return listAlertRules(app, request, reply, input);
  });

  // POST /api/alert-rules
  app.post('/api/alert-rules', {
    schema: {
      body: {
        type: 'object',
        properties: {
          name: { type: 'string' },
          type: { type: 'string' },
          threshold: { type: 'object' },
          channels: { type: 'array' }
        },
        required: ['name', 'type', 'channels'],
      },
    },
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = request.body as Record<string, unknown>;
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return createAlertRule(app, request, reply, input);
  });

  // PATCH /api/alert-rules/:ruleId
  app.patch('/api/alert-rules/:ruleId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return updateAlertRule(app, request, reply, input);
  });

  // DELETE /api/alert-rules/:ruleId
  app.delete('/api/alert-rules/:ruleId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return deleteAlertRule(app, request, reply, input);
  });

});
