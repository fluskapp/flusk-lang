// @generated by flusk-lang â€” DO NOT EDIT

import { EventEmitter } from 'node:events';
import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

export const SLACK_MESSAGE_RECEIVED = 'slack-message-received';

export interface SlackMessageReceivedPayload {
  message_id: string;
}

export interface FluskEvents {
  'slack-message-received': SlackMessageReceivedPayload;
}

export class FluskEventBus {
  private emitter = new EventEmitter();

  emit<K extends keyof FluskEvents>(event: K, payload: FluskEvents[K]): void {
    this.emitter.emit(event, payload);
  }

  on<K extends keyof FluskEvents>(event: K, handler: (payload: FluskEvents[K]) => void | Promise<void>): void {
    this.emitter.on(event, handler);
  }

  off<K extends keyof FluskEvents>(event: K, handler: (payload: FluskEvents[K]) => void | Promise<void>): void {
    this.emitter.off(event, handler);
  }
}

declare module 'fastify' {
  interface FastifyInstance {
    events: FluskEventBus;
  }
}

export default fp(async (app: FastifyInstance) => {
  const bus = new FluskEventBus();
  app.decorate('events', bus);
  app.log.info('Event bus registered');
});
