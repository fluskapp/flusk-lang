// @generated by flusk-lang â€” DO NOT EDIT

import { EventEmitter } from 'node:events';
import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

export const SOLUTION_CREATED = 'solution-created';
export const SOLUTION_PUBLISHED = 'solution-published';
export const KNOWLEDGE_UPLOADED = 'knowledge-uploaded';

export interface SolutionCreatedPayload {
  solution_id: string;
  org_id: string;
}

export interface SolutionPublishedPayload {
  solution_id: string;
  deployment_id: string;
  channel: string;
  org_id: string;
}

export interface KnowledgeUploadedPayload {
  kb_id: string;
  solution_id: string;
}

export interface FluskEvents {
  'solution-created': SolutionCreatedPayload;
  'solution-published': SolutionPublishedPayload;
  'knowledge-uploaded': KnowledgeUploadedPayload;
}

export class FluskEventBus {
  private emitter = new EventEmitter();

  emit<K extends keyof FluskEvents>(event: K, payload: FluskEvents[K]): void {
    this.emitter.emit(event, payload);
  }

  on<K extends keyof FluskEvents>(event: K, handler: (payload: FluskEvents[K]) => void | Promise<void>): void {
    this.emitter.on(event, handler);
  }

  off<K extends keyof FluskEvents>(event: K, handler: (payload: FluskEvents[K]) => void | Promise<void>): void {
    this.emitter.off(event, handler);
  }
}

declare module 'fastify' {
  interface FastifyInstance {
    events: FluskEventBus;
  }
}

export default fp(async (app: FastifyInstance) => {
  const bus = new FluskEventBus();
  app.decorate('events', bus);
  app.log.info('Event bus registered');
});
