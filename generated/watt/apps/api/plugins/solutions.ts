// @generated by flusk-lang â€” DO NOT EDIT

import type { FastifyInstance, FastifyRequest, FastifyReply } from 'fastify';
import fp from 'fastify-plugin';

import runSolutionSandbox from '../functions/runSolutionSandbox.js';
import provisionDeployment from '../functions/provisionDeployment.js';
import teardownDeployment from '../functions/teardownDeployment.js';
import listSolutions from '../functions/listSolutions.js';
import getSolution from '../functions/getSolution.js';
import createSolution from '../functions/createSolution.js';
import updateSolution from '../functions/updateSolution.js';
import deleteSolution from '../functions/deleteSolution.js';
import testSolution from '../functions/testSolution.js';
import publishSolution from '../functions/publishSolution.js';
import unpublishDeployment from '../functions/unpublishDeployment.js';
import listDeployments from '../functions/listDeployments.js';
import uploadKnowledge from '../functions/uploadKnowledge.js';
import deleteKnowledge from '../functions/deleteKnowledge.js';
import getSolutionUsage from '../functions/getSolutionUsage.js';

export default fp(async (app: FastifyInstance) => {

  // GET /api/solutions
  app.get('/api/solutions', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return listSolutions(app, request, reply, input);
  });

  // GET /api/solutions/:solutionId
  app.get('/api/solutions/:solutionId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return getSolution(app, request, reply, input);
  });

  // POST /api/solutions
  app.post('/api/solutions', {
    schema: {
      body: {
        type: 'object',
        properties: {
          name: { type: 'string' },
          description: { type: 'string' },
          llmProvider: { type: 'string' },
          llmModel: { type: 'string' },
          systemPrompt: { type: 'string' },
          temperature: { type: 'number' },
          maxTokens: { type: 'integer' },
          toolsConfig: { type: 'object' }
        },
        required: ['name', 'llmProvider', 'llmModel'],
      },
    },
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = request.body as Record<string, unknown>;
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return createSolution(app, request, reply, input);
  });

  // PATCH /api/solutions/:solutionId
  app.patch('/api/solutions/:solutionId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return updateSolution(app, request, reply, input);
  });

  // DELETE /api/solutions/:solutionId
  app.delete('/api/solutions/:solutionId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return deleteSolution(app, request, reply, input);
  });

  // POST /api/solutions/:solutionId/test
  app.post('/api/solutions/:solutionId/test', {
    schema: {
      body: {
        type: 'object',
        properties: {
          message: { type: 'string' }
        },
        required: ['message'],
      },
    },
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = request.body as Record<string, unknown>;
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return testSolution(app, request, reply, input);
  });

  // POST /api/solutions/:solutionId/publish
  app.post('/api/solutions/:solutionId/publish', {
    schema: {
      body: {
        type: 'object',
        properties: {
          channel: { type: 'string' },
          channelConfig: { type: 'object' }
        },
        required: ['channel', 'channelConfig'],
      },
    },
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = request.body as Record<string, unknown>;
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return publishSolution(app, request, reply, input);
  });

  // DELETE /api/deployments/:deploymentId
  app.delete('/api/deployments/:deploymentId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return unpublishDeployment(app, request, reply, input);
  });

  // GET /api/deployments
  app.get('/api/deployments', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return listDeployments(app, request, reply, input);
  });

  // POST /api/solutions/:solutionId/knowledge
  app.post('/api/solutions/:solutionId/knowledge', {
    schema: {
      body: {
        type: 'object',
        properties: {
          name: { type: 'string' },
          type: { type: 'string' },
          source: { type: 'string' }
        },
        required: ['name', 'type', 'source'],
      },
    },
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = request.body as Record<string, unknown>;
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return uploadKnowledge(app, request, reply, input);
  });

  // DELETE /api/solutions/:solutionId/knowledge/:kbId
  app.delete('/api/solutions/:solutionId/knowledge/:kbId', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return deleteKnowledge(app, request, reply, input);
  });

  // GET /api/solutions/:solutionId/usage
  app.get('/api/solutions/:solutionId/usage', {
    onRequest: [app.authenticate],
  }, async (request: FastifyRequest, reply: FastifyReply) => {
    const input = {};
    const params = request.params as Record<string, string>;
    Object.assign(input, params);
    const user = request.user as { sub: number; org: number; role: string };
    Object.assign(input, { org_id: user.org, user_id: user.sub });
    return getSolutionUsage(app, request, reply, input);
  });

});
