// @generated by flusk-lang â€” DO NOT EDIT

import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';
import { ORG_CREATED, MEMBER_INVITED, OrgCreatedPayload, MemberInvitedPayload } from './event-bus.js';

import { sendInviteEmail } from '../workers/sendInviteEmail.js';

export default fp(async (app: FastifyInstance) => {

  // org-created
  app.events.on(ORG_CREATED, async (payload: OrgCreatedPayload) => {
    app.log.info({ event: ORG_CREATED, payload }, 'Event received');
  });

  // member-invited
  app.events.on(MEMBER_INVITED, async (payload: MemberInvitedPayload) => {
    app.log.info({ event: MEMBER_INVITED, payload }, 'Event received');
    try {
      await sendInviteEmail(app.platformatic, payload);
    } catch (err) {
      app.log.error({ err, worker: 'send-invite-email' }, 'Worker failed');
    }
  });
});
