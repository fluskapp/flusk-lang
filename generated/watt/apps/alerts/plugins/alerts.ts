// @generated by flusk-lang â€” DO NOT EDIT

import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

import { listAlerts } from '../functions/listAlerts.js';
import { getAlert } from '../functions/getAlert.js';
import { acknowledgeAlert } from '../functions/acknowledgeAlert.js';
import { resolveAlert } from '../functions/resolveAlert.js';
import { dismissAlert } from '../functions/dismissAlert.js';
import { listAlertRules } from '../functions/listAlertRules.js';
import { createAlertRule } from '../functions/createAlertRule.js';
import { updateAlertRule } from '../functions/updateAlertRule.js';
import { deleteAlertRule } from '../functions/deleteAlertRule.js';
import { createAlert } from '../functions/createAlert.js';
import { checkUsageSpike } from '../functions/checkUsageSpike.js';
import { sendAlertNotification } from '../functions/sendAlertNotification.js';

export default fp(async (app: FastifyInstance) => {

  app.get('/api/alerts', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await listAlerts(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/alerts/:alertId', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getAlert(app.platformatic, request);
    return reply.send(result);
  });

  app.patch('/api/alerts/:alertId/ack', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await acknowledgeAlert(app.platformatic, request);
    return reply.send(result);
  });

  app.patch('/api/alerts/:alertId/resolve', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await resolveAlert(app.platformatic, request);
    return reply.send(result);
  });

  app.patch('/api/alerts/:alertId/dismiss', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await dismissAlert(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/alert-rules', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await listAlertRules(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/alert-rules', {
    schema: {
      body: {
        type: 'object',
        properties: {
          name: { type: 'string' },
          type: { type: 'string' },
          threshold: { type: 'string' },
          channels: { type: 'string' },
        },
        required: ['name', 'type', 'channels'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await createAlertRule(app.platformatic, request);
    return reply.send(result);
  });

  app.patch('/api/alert-rules/:ruleId', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await updateAlertRule(app.platformatic, request);
    return reply.send(result);
  });

  app.delete('/api/alert-rules/:ruleId', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await deleteAlertRule(app.platformatic, request);
    return reply.send(result);
  });
});
