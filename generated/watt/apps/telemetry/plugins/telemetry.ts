// @generated by flusk-lang â€” DO NOT EDIT

import { type FastifyInstance } from 'fastify';
import fp from 'fastify-plugin';

import { ingestOtel } from '../functions/ingestOtel.js';
import { agentHeartbeat } from '../functions/agentHeartbeat.js';
import { getUsageSummary } from '../functions/getUsageSummary.js';
import { getUsageByProvider } from '../functions/getUsageByProvider.js';
import { getUsageByEmployee } from '../functions/getUsageByEmployee.js';
import { getShadowAi } from '../functions/getShadowAi.js';
import { getUsageTrends } from '../functions/getUsageTrends.js';
import { listDevices } from '../functions/listDevices.js';
import { revokeDevice } from '../functions/revokeDevice.js';
import { listTools } from '../functions/listTools.js';
import { approveTool } from '../functions/approveTool.js';
import { processTelemetryBatch } from '../functions/processTelemetryBatch.js';
import { registerOrUpdateDevice } from '../functions/registerOrUpdateDevice.js';
import { setupDefaultTools } from '../functions/setupDefaultTools.js';
import { aggregateDailyUsage } from '../functions/aggregateDailyUsage.js';

export default fp(async (app: FastifyInstance) => {

  app.post('/api/v1/telemetry/ingest', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await ingestOtel(app.platformatic, request);
    return reply.send(result);
  });

  app.post('/api/v1/telemetry/heartbeat', {
    schema: {
      body: {
        type: 'object',
        properties: {
          device_id: { type: 'string' },
          hostname: { type: 'string' },
          os: { type: 'string' },
          arch: { type: 'string' },
          agent_version: { type: 'string' },
        },
        required: ['device_id'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await agentHeartbeat(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/dashboard/usage', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getUsageSummary(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/dashboard/usage/providers', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getUsageByProvider(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/dashboard/usage/employees', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getUsageByEmployee(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/dashboard/shadow-ai', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getShadowAi(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/dashboard/trends', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await getUsageTrends(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/devices', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await listDevices(app.platformatic, request);
    return reply.send(result);
  });

  app.delete('/api/devices/:deviceId', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await revokeDevice(app.platformatic, request);
    return reply.send(result);
  });

  app.get('/api/tools', {
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await listTools(app.platformatic, request);
    return reply.send(result);
  });

  app.patch('/api/tools/:toolId', {
    schema: {
      body: {
        type: 'object',
        properties: {
          approved: { type: 'boolean' },
        },
        required: ['approved'],
      },
    },
    preHandler: app.auth,
  }, async (request, reply) => {
    const result = await approveTool(app.platformatic, request);
    return reply.send(result);
  });
});
