// @generated by flusk-lang — DO NOT EDIT

import { test } from 'node:test';
import assert from 'node:assert/strict';
import { buildServer } from '@platformatic/service';

test('whatsapp-bot — webhook-flow', async () => {
  const app = await buildServer('./apps/whatsapp-bot/platformatic.json');
  await app.start();
  const baseUrl = app.url;

  {
    const res = await fetch(`${baseUrl}/webhooks/whatsapp/test-bot-id`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({"message":{"from":"+1234567890","body":"Hello"}}),
    });
    assert.equal(res.status, 200);
  }

  // Wait: process-incoming-message
  await new Promise((r) => setTimeout(r, 100));

  // Assert: messages.count > 0

  await app.close();
});
